<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Turnos</title>
    <style>
        body { font-family: sans-serif; background-color: #f1f3f4; padding: 20px; display: flex; justify-content: center; }
        .container-admin { width: 100%; max-width: 1000px; background: white; padding: 40px; border-radius: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        h1 { font-size: 24px; margin-bottom: 25px; }
        
        .header-actions { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .filter-group { display: flex; gap: 10px; align-items: center; background: #f8f9fa; padding: 15px; border-radius: 20px; }
        
        input { padding: 12px; border: 1px solid #dee2e6; border-radius: 12px; font-size: 14px; }

        /* Estilos de botones solicitados */
        .btn-buscar { background-color: #1a73e8; color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .btn-nuevo { background-color: #34a853; color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { text-align: left; padding: 15px; border-bottom: 2px solid #eee; color: #5f6368; font-size: 13px; }
        td { padding: 15px; border-bottom: 1px solid #eee; font-size: 14px; }
        
        .btn-edit { background: #1a73e8; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; }
        .btn-delete { background: #d93025; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container-admin">
        <h1>Gesti√≥n de Turnos</h1>
        
        <div class="header-actions">
            <div class="filter-group">
                <input type="date" id="filtroFecha">
                <input type="text" id="filtroDNI" placeholder="Buscar por DNI...">
                <button class="btn-buscar" onclick="cargarTurnos()">
                    <span>üîç</span> Buscar / Actualizar
                </button>
            </div>

            <button class="btn-nuevo" onclick="window.location.href='index.html'">
                <span>+</span> Nuevo Turno
            </button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>FECHA</th>
                    <th>HORARIO</th>
                    <th>PACIENTE</th>
                    <th>DNI</th>
                    <th>TIPO</th>
                    <th>ACCIONES</th>
                </tr>
            </thead>
            <tbody id="tabla-turnos"></tbody>
        </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const _supabase = supabase.createClient('https://uekuyjoakqnhjltqrrpj.supabase.co', 'sb_publishable_COB2p3O_OrgFdO3W6EvLvg_DuicBhwj');

        async function cargarTurnos() {
            const fecha = document.getElementById('filtroFecha').value;
            const dni = document.getElementById('filtroDNI').value;
            let query = _supabase.from('turnos').select('*').order('fecha').order('hora_inicio');
            
            if (fecha) query = query.eq('fecha', fecha);
            if (dni) query = query.ilike('dni', `%${dni}%`);

            const { data: turnos } = await query;
            const tbody = document.getElementById('tabla-turnos');
            tbody.innerHTML = turnos.map(t => `
                <tr>
                    <td>${t.fecha.split('-').reverse().join('/')}</td>
                    <td>${t.hora_inicio.substring(0,5)} - ${t.hora_fin.substring(0,5)}</td>
                    <td>${t.nombre}</td>
                    <td>${t.dni}</td>
                    <td>${t.tipo_turno}</td>
                    <td>
                        <button class="btn-edit" onclick="window.location.href='editar.html?id=${t.id}&nombre=${encodeURIComponent(t.nombre)}&dni=${t.dni}&tipo=${t.tipo_turno}&fecha=${t.fecha}&hora=${t.hora_inicio}'">Editar</button>
                        <button class="btn-delete" onclick="eliminar('${t.id}')">Eliminar</button>
                    </td>
                </tr>
            `).join('');
        }

        async function eliminar(id) {
            if(confirm('¬øEliminar turno?')) {
                await _supabase.from('turnos').delete().eq('id', id);
                cargarTurnos();
            }
        }
        window.onload = cargarTurnos;
    </script>
</body>
</html>
